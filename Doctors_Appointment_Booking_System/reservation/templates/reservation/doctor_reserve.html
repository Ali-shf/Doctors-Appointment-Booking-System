{% extends "base.html" %}
{% load static %}

{% block title %}رزرو نوبت - {{ doctor }} در {{ clinic.name }}{% endblock %}

{% block content %}
{% block head %}
<style>
  .avatar { width:56px;height:56px;border-radius:50%;background: radial-gradient(circle at 30% 30%, rgba(13,110,253,.25), rgba(13,110,253,.05) 70%); }
  .pill { border-radius: 999px; padding: 6px 14px; }
  .card { border: 0; box-shadow: 0 6px 24px rgba(0,0,0,.06); transition: transform .15s ease, box-shadow .15s ease; }
  .card:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(0,0,0,.08); }
  .meta { color:#6c7b8a; font-size: .9rem; }
  .date-badge { display:inline-block; padding:6px 10px; border-radius: 10px; background:#f3f7ff; color:#3f5ea6; border:1px solid #e3ecff; font-weight:600; }
  .slot-btn { --bs-btn-border-color:#dee6f3; --bs-btn-hover-border-color:#b8cff7; }
  .slot-booked { border-color:#f1c0c0; color:#b24a4a; background:#fff5f5; }
  .slot-pending { border-color:#ffe8a3; color:#947000; background:#fffaf0; }
  .slot-btn:hover{ box-shadow:0 4px 14px rgba(13,110,253,.15); }
  .clinic-line { color:#5b6b7b; }
  .section-title { font-size: .95rem; color:#6c7b8a; font-weight:600; letter-spacing:.2px; }
</style>
{% endblock %}
<div class="container my-4">
    <div class="d-flex align-items-center gap-3 mb-3">
        <div class="avatar d-flex align-items-center justify-content-center">
            <span class="text-primary fw-bold">{{ doctor.user.first_name|default:doctor.user.username|slice:":1" }}</span>
        </div>
        <div>
            <h2 class="mb-1">رزرو نوبت برای {{ doctor }} در {{ clinic.name }}</h2>
            {% if doctor.get_specialties %}
                <div class="small text-muted">{{ doctor.get_specialties }}</div>
            {% endif %}
        </div>
    </div>

    {% if messages %}
    <div>
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    {% if timesheets %}
        <div class="row g-3">
            {% for ts in timesheets %}
            <div class="col-12 col-md-6">
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                          <h5 class="card-title mb-0">کلینیک: {{ clinic.name }}</h5>
                          <span class="date-badge">{{ ts.end|date:"Y/m/d" }}</span>
                        </div>
                        {% if ts.clinic.address or ts.clinic.description %}
                        <div class="clinic-line meta mb-3">
                          {{ ts.clinic.address|default:ts.clinic.description|truncatechars:90 }}
                        </div>
                        {% endif %}

                        <form method="post" action="">
                            {% csrf_token %}
                            <input type="hidden" name="timesheet_id" value="{{ ts.id }}">
                            <div class="section-title mb-2">انتخاب ساعت</div>
                            <div class="d-flex flex-wrap gap-2">
                                {% for slot in ts.visit_time %}
                                    {% if slot in ts.booked_slots %}
                                        <button type="button" class="btn btn-sm pill slot-booked" disabled>{{ slot }} (پر شده)</button>
                                    {% else %}
                                        <button name="slot" value="{{ slot }}" type="submit" class="btn btn-sm btn-outline-primary pill slot-btn">{{ slot }}</button>
                                    {% endif %}
                                {% empty %}
                                    <span class="text-danger">زمانی ثبت نشده است.</span>
                                {% endfor %}
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">برای این پزشک زمان فعالی ثبت نشده است.</div>
    {% endif %}
</div>
{% endblock %}


