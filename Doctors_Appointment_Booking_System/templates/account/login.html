{% load static %}
{% load socialaccount %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sign in</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <style>
      :root{
        --bg1:#0ea5e9; /* sky-500 */
        --bg2:#6366f1; /* indigo-500 */
        --card:#ffffffcc; /* glass */
        --ring:#93c5fd; /* blue-300 */
      }
      /* Gradient background with subtle noise */
      body{
        min-height:100vh;
        background: radial-gradient(1200px 600px at 10% 10%, rgba(255,255,255,.18), transparent 45%),
                    radial-gradient(1000px 500px at 90% 20%, rgba(255,255,255,.12), transparent 50%),
                    linear-gradient(135deg, var(--bg1), var(--bg2));
        background-attachment: fixed;
      }
      .login-wrapper{ padding-top: clamp(32px, 6vh, 72px); padding-bottom: clamp(24px, 5vh, 64px); }
      .login-card{
        background: var(--card);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255,255,255,.35);
        box-shadow: 0 20px 50px rgba(0,0,0,.15);
        border-radius: 1.25rem;
      }
      .brand-badge{
        display: inline-flex; align-items:center; gap:.5rem;
        padding:.5rem .75rem; border-radius: 999px; font-size:.85rem;
        background: rgba(255,255,255,.6); border:1px solid rgba(255,255,255,.8);
      }
      .divider{ position: relative; text-align: center; margin: 1.25rem 0; }
      .divider span{ background: var(--card); padding: .25rem .75rem; border-radius: 999px; font-size: .85rem; color:#475569; }
      .divider::before{ content:""; position:absolute; left:0; right:0; top:50%; border-top:1px dashed rgba(2,6,23,.25); }

      /* Inputs — style raw Django fields even if no .form-control class is set */
      .pretty-input{ width:100%; padding:.75rem .875rem .75rem 2.75rem; border-radius:.8rem; border:1px solid rgba(2,6,23,.12); background:#fff; transition: box-shadow .2s, border-color .2s; }
      .pretty-input:focus{ outline: none; border-color: var(--ring); box-shadow: 0 0 0 .25rem rgba(147,197,253,.35); }
      .input-wrap{ position: relative; }
      .input-wrap i{ position:absolute; left:.9rem; top:50%; transform:translateY(-50%); opacity:.6; }

      .alert{ border-radius:.75rem; }
      .error-text{ color:#dc3545; font-size: .825rem; }

      .btn-primary{ border-radius:.9rem; padding:.75rem; font-weight:600; }
      .btn-ghost{ background: #ffffffaa; border:1px solid rgba(2,6,23,.08); border-radius:.9rem; }
      .btn-ghost:hover{ background:#fff; }

      /* Provider buttons */
      .provider-btn{ display:flex; align-items:center; justify-content:center; gap:.5rem; width:100%; padding:.65rem .9rem; border-radius:.9rem; border:1px solid rgba(2,6,23,.1); background:#fff; text-decoration:none; font-weight:600; }
      .provider-btn:hover{ background:#f8fafc; border-color: rgba(2,6,23,.2); }

      .footnote{ color:#e2e8f0; }
    </style>
  </head>
  <body>
    <div class="container login-wrapper">
      <div class="row justify-content-center">
        <div class="col-11 col-md-8 col-lg-5 col-xl-4">
          <div class="login-card p-4 p-md-5">

            <div class="d-flex justify-content-center mb-3">
              <span class="brand-badge">
                <i class="bi bi-heart-pulse"></i>
                Doctor–Patient Booking System
              </span>
            </div>

            <h1 class="h4 text-center fw-bold mb-3">Welcome back</h1>
            <p class="text-center text-muted mb-4">Sign in to manage appointments, doctors, and patients.</p>

            {% if messages %}
              <div class="mb-3">
                {% for message in messages %}
                  <div class="alert alert-{{ message.tags }} mb-2">{{ message }}</div>
                {% endfor %}
              </div>
            {% endif %}

            <form method="post" novalidate class="needs-validation">
              {% csrf_token %}

              <div class="mb-3">
                <label class="form-label" for="{{ form.username.id_for_label }}">Username</label>
                <div class="input-wrap">
                  <i class="bi bi-person"></i>
                  {# Even if the widget lacks classes, we provide a styled fallback #}
                  {{ form.username }}
                </div>
                {% for err in form.username.errors %}
                  <div class="error-text mt-1">{{ err }}</div>
                {% endfor %}
              </div>

              <div class="mb-2">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="form-label mb-0" for="{{ form.password.id_for_label }}">Password</label>
                  <a class="small text-decoration-none" href="#">Forgot?</a>
                </div>
                <div class="input-wrap">
                  <i class="bi bi-lock"></i>
                  {{ form.password }}
                </div>
                {% for err in form.password.errors %}
                  <div class="error-text mt-1">{{ err }}</div>
                {% endfor %}
              </div>

              {% if form.non_field_errors %}
                <div class="error-text mb-3">{{ form.non_field_errors }}</div>
              {% endif %}

              <button class="btn btn-primary w-100 mt-2" type="submit">
                <i class="bi bi-box-arrow-in-right me-1"></i> Sign in
              </button>

              <div class="d-grid gap-2 mt-3">
                <a class="btn btn-ghost" href="{% url 'otp-login-page' %}">
                  <i class="bi bi-shield-lock"></i>
                  One‑Time Code (OTP)
                </a>
              </div>

              <div class="divider mt-4"><span>or continue with</span></div>

{#              {% get_providers as socialaccount_providers %}#}
{#              {% if socialaccount_providers %}#}
{#                <div class="row g-2">#}
{#                  {% for provider in socialaccount_providers %}#}
{#                    {% if provider.social_app %}#}
{#                      <div class="col-12 col-sm-6">#}
{#                        <a class="provider-btn" href="{% provider_login_url provider.id process='login' %}">#}
{#                          {% if provider.id == 'google' %}<i class="bi bi-google"></i>{% endif %}#}
{#                          {% if provider.id == 'github' %}<i class="bi bi-github"></i>{% endif %}#}
{#                          {% if provider.id == 'facebook' %}<i class="bi bi-facebook"></i>{% endif %}#}
{#                          <span>{{ provider.name }}</span>#}
{#                        </a>#}
{#                      </div>#}
{#                    {% endif %}#}
{#                  {% endfor %}#}
{#                </div>#}
{#              {% endif %}#}
            
            <div class="row g-2">
                  <div class="col-12 col-sm-6">
                    {% load socialaccount %}
                    <a class="provider-btn" href="{% provider_login_url 'google' process='login' %}">
                        Google
                    </a>
                  </div>
            </div>

            </form>

            <p class="text-center mt-4 mb-0">
              New here?
              <a class="fw-semibold text-decoration-none" href="{% url 'register' %}">Create an account</a>
            </p>
          </div>

          <p class="text-center footnote mt-3 small">&copy; {{ now|default:2025 }} HealthApp</p>
        </div>
      </div>
    </div>

    <script>
      // Add classes to raw Django inputs if widgets weren't customized
      (function(){
        const u = document.getElementById('{{ form.username.id_for_label }}');
        const p = document.getElementById('{{ form.password.id_for_label }}');
        [u,p].forEach(el=>{ if(el){ el.classList.add('pretty-input'); } });
      })();
    </script>
  </body>
</html>
