{% extends 'base_generic.html' %}
{% block title %}Wallet - Top up{% endblock %}
{% block content %}
<div class="row justify-content-center">
<div class="col-md-6">
<div class="card p-4">
<h4 class="mb-3">Top Up Wallet</h4>
<form id="topup-form">
<div class="mb-3">
<label class="form-label">Amount</label>
<input id="amount" name="amount" class="form-control" placeholder="100.00">
</div>
<div class="d-flex gap-2">
<button class="btn btn-primary" type="submit">Top up</button>
<a class="btn btn-outline-secondary" href="{% url 'wallet:index' %}">Cancel</a>
</div>
</form>


<div id="result" class="mt-3"></div>
</div>
</div>
</div>


{% block scripts %}
<script>
function csrftoken(){
return document.cookie.split('; ').find(r=>r.startsWith('csrftoken='))?.split('=')[1];
}


document.getElementById('topup-form').addEventListener('submit', async (e)=>{
e.preventDefault();
const amount = document.getElementById('amount').value.trim();
const fd = new FormData(); fd.append('amount', amount);
const res = await fetch('{% url "wallet:top_up" %}', {method: 'POST', body: fd, headers: {'X-CSRFToken': csrftoken()}});
const json = await res.json();
const box = document.getElementById('result');
if (!res.ok) {
box.innerHTML = `<div class="alert alert-danger">${json.error || 'Failed'}</div>`;
} else {
box.innerHTML = `<div class="alert alert-success">${json.message} â€” new balance: ${json.balance}</div>`;
}
});
</script>
{% endblock %}
{% endblock %}